!function(e){"use strict";function t(){}function r(e,t,r){if(r.treeEvents)for(var a=r.treeEvents.split(";"),n=0;n<a.length;n++)if(a[n].length>0){var s=a[n].split(":")[0];s.indexOf(".")<0&&(s+=".jstree");var i=a[n].split(":")[1];e.tree.on(s,e.$parent.$eval(i))}}function a(e,t){t.tree.on("changed.jstree",function(r,a){e(function(){t.selectedData=a.selected},0)})}function n(t,n){var s={restrict:"A",controller:"jsTreeCtrl",scope:{status:"=",treeData:"=",treeConfig:"=jsTree",plugins:"=",treeTypes:"=",selectedData:"=",tree:"=",service:"=",serviceType:"=",params:"="},link:function(s,i,c){var o={core:{multiple:!1,animation:!1,error:function(r){t.error("生成树错误:"+e.toJson(r))},check_callback:!0,worker:!1,themes:{icons:!1}},types:{},plugins:[]};$.extend(o,s.treeConfig);var l=$.extend(!0,{},{multiple:"true"===c.multiple?!0:!1,animation:"true"===c.animation?!0:!1},i.data());$.extend(o.core,l),o.core.multiple&&o.plugins.push("checkbox"),s.treeTypes&&("string"==typeof s.treeTypes?o.types={"default":{icon:s.treeTypes}}:"object"==typeof s.treeTypes&&(o.types=s.treeTypes),o.plugins.push("types")),o.plugins.concat(o.plugins,s.plugins),e.isString(s.service)?(s.serviceType="ajax",o.core.data={url:s.service},o.core.data=e.isFunction(s.params)?{data:s.params}:{data:function(e){return"#"!==e.id?{id:e.id}:{}}},o.core.data.success=function(e){s.treeData||(s.treeData=[]),s.treeData=s.treeData.concat(e)}):e.isFunction(s.service)?(s.serviceType="ajax",o.core.data=function(t,r){var a=e.isFunction(s.params)?s.params(t):t;s.service(a,function(e){s.treeData||(s.treeData=[]),s.treeData=s.treeData.concat(e),r.call(this,e)})}):o.core.data=function(e,t){t.call(this,s.treeData)},s.init=function(){if(i.jstree(o),s.tree=i,a(n,s,i,c),r(s,i,c),s.selectedData&&s.selectedData.length>0){var e=s.tree.jstree(!0);e.select_node(s.selectedData,!1)}},s.destroy=function(){s.tree&&(i.jstree("destroy",!0),s.tree=null)},("ajax"===s.serviceType||s.treeData&&s.length>0)&&s.init(),s.$watch("status",function(e){""!=e&&("reload"==e&&(s.destroy(i),s.init(s,i,c,o)),s.status="")},!0),s.$watch("treeData",function(e,t){"ajax"!==s.serviceType&&t!==e&&null!=t&&(s.destroy(i),s.treeData=e,s.init(s,i,c,o))},!0),s.$watch("selectedData",function(e,t){if(t!==e){var r=s.tree.jstree(!0);r.select_node(e,!1,!1)}},!0)}};return s}var s=e.module("ngJsTree",[]);s.controller("jsTreeCtrl",["$scope",t]),s.directive("jsTree",["$log","$timeout",n])}(angular);